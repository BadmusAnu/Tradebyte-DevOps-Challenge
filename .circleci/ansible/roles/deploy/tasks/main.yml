  
  - name: Update
    apt: update_cache=yes

  - name: Installing Redis
    apt: name=redis-server state=latest

  - name: start Redis Server
    service: name=redis state=started enabled=yes

  - name: Install required system packages
    apt:
      pkg:
        - apt-transport-https
        - ca-certificates
        - curl
        - software-properties-common
        - python3-pip
        - virtualenv
        - python3-setuptools
      state: latest
      update_cache: true

  - name: copy env files
    become: yes
    copy:
      src: ../../.env
      dest: /home/ubuntu/.env

  - name: Add Docker GPG apt Key
    apt_key:
      url: https://download.docker.com/linux/ubuntu/gpg
      state: present 

  - name: Add Docker Repository
    apt_repository:
      repo: deb https://download.docker.com/linux/ubuntu focal stable
      state: present

  - name: Update apt and install docker-ce
    apt:
      name: docker-ce
      state: latest
      update_cache: true

  - name: Install Docker Module for Python
    pip:
      name: docker  
  
  - name: pull an image
    docker_image:
      name: badmusanu/tradebyte

  - name: Install Docker Compose
    get_url:
      url: "https://github.com/docker/compose/releases/download/1.28.2/docker-compose-Linux-x86_64"
      dest: /usr/local/bin/docker-compose
      mode: u+x,g+x,o+x 

  - name: Create and start services
    docker_compose:
        project_src: ../../docker-compose.yml
    register: output

        
        

